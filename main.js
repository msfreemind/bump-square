(()=>{"use strict";class t{constructor(t,e){this.i=t,this.j=e}equals(t){return this.i==t.i&&this.j==t.j}isOpposite(t){return this.i==-1*t.i&&this.j==-1*t.j}plus(e){return new t(this.i+e.i,this.j+e.j)}}const e=t,s=(t,e)=>JSON.stringify(t)===JSON.stringify(e),o=t=>[Math.floor(t.i/40),Math.floor(t.j/40)];class i{constructor(t,e){this.color=e,this.reachedFinish=!1,this.dead=!1,this.levelTickRate=t.map.tickRate,this.board=t,this.pos=t.startPos,this.tilePos=o(this.pos),this.dx=i.DEFAULT_SPEED,this.dy=0}async move(){0!==this.dx?this.board.validPosition(this.pos.plus(new e(20*this.dx,0)),!0)||this.reorient():this.board.validPosition(this.pos.plus(new e(0,20*this.dy)),!0)||this.reorient(),this.updatePos(this.pos.plus(new e(this.dx,this.dy))),this.board.atFinish(this.tilePos)?(await new Promise((t=>setTimeout(t,19*this.levelTickRate))),this.reachedFinish=!0):this.board.onDeathSquare(this.tilePos)&&(await new Promise((t=>setTimeout(t,19*this.levelTickRate))),this.dead=!0)}updatePos(t){this.pos=t,this.tilePos=o(this.pos)}moveDelta(t){return t>0?t+2:t-3}reorient(){0!==this.dx?this.board.validPosition([this.tilePos[0],this.tilePos[1]+this.dx],!1)?(this.dy=this.dx,this.dx=0):this.board.validPosition([this.tilePos[0],this.tilePos[1]-this.dx],!1)?(this.dy=-this.dx,this.dx=0):this.dx=-this.dx:this.board.validPosition([this.tilePos[0]+this.dy,this.tilePos[1]],!1)?(this.dx=this.dy,this.dy=0):this.board.validPosition([this.tilePos[0]-this.dy,this.tilePos[1]],!1)?(this.dx=-this.dy,this.dy=0):this.dy=-this.dy}}i.DEFAULT_SPEED=1;const a=i;class l{constructor(t){this.map=JSON.parse(JSON.stringify(t)),this.startPos=new e(40*t.start[0]+20,40*t.start[1]+20),this.aBlocksMoved=!1,this.dBlocksMoved=!1,this.shuttlesMoved=!1,this.men=[],this.menQuota=t.menQuota,this.goalCount=0,this.loadPlayer()}loadPlayer(){this.men.length<this.menQuota-this.goalCount&&this.men.push(new a(this,"lime"))}addGoal(){this.goalCount++}getABlocks(){return Object.values(this.map.aBlocks)}getDBlocks(){return Object.values(this.map.dBlocks)}getShuttles(){return Object.values(this.map.shuttles)}getDeathSquares(){return Object.values(this.map.deathSquares)}pushBlockCollision(t){return this.getABlocks().concat(this.getDBlocks()).some((e=>s(e.pos,t)))}onFloor(t){return!!this.map.floor.some((e=>s(e,t)))||this.getShuttles().some((e=>s(e.pos,t)))}validPosition(t,e){let i=[];return i=e?o(t):t,!this.pushBlockCollision(i)&&(!(!s(this.map.start,i)&&!s(this.map.end,i))||!!this.onDeathSquare(i)||this.onFloor(i))}atFinish(t){return!!s(this.map.end,t)}onDeathSquare(t){return this.getDeathSquares().some((e=>s(e,t)))&&!this.onFloor(t)}removeMan(t){this.men.splice(t,1)}moveABlocks(){this.aBlocksMoved?this.getABlocks().forEach((t=>this.movePushBlock(t,l.DISENGAGE))):this.getABlocks().forEach((t=>this.movePushBlock(t,l.ENGAGE))),this.aBlocksMoved=!this.aBlocksMoved}moveDBlocks(){this.dBlocksMoved?this.getDBlocks().forEach((t=>this.movePushBlock(t,l.DISENGAGE))):this.getDBlocks().forEach((t=>this.movePushBlock(t,l.ENGAGE))),this.dBlocksMoved=!this.dBlocksMoved}movePushBlock(t,o){let i=!1;t.pos[0]+=t.movement[0]*o,t.pos[1]+=t.movement[1]*o,this.men.filter((e=>s(e.tilePos,t.pos))).forEach((s=>{this.pushBlockCollision([s.tilePos[0]+t.movement[0]*o,s.tilePos[1]+t.movement[1]*o])||(i||(i=!0),s.updatePos(s.pos.plus(new e(80*t.movement[0]*o,80*t.movement[1]*o))),this.validPosition(s.tilePos,!1)?0===s.dx&&0!==t.movement[0]?(s.dx=t.movement[0]>0?a.DEFAULT_SPEED:-a.DEFAULT_SPEED,s.dy=0):0===s.dy&&0!==t.movement[1]&&(s.dx=0,s.dy=t.movement[1]>0?a.DEFAULT_SPEED:-a.DEFAULT_SPEED):s.dead=!0)}))}moveShuttles(){let t=!1;this.shuttlesMoved?this.getShuttles().forEach((o=>{this.men.filter((t=>s(t.tilePos,o.pos))).forEach((t=>{let s=!1;for(let i=1;i<=Math.abs(o.movement[0]);i++){let a=o.movement[0]>=0?-1:1;if(this.pushBlockCollision([t.tilePos[0]+i*a,t.tilePos[1]])){t.updatePos(t.pos.plus(new e(-40*(i-1),0))),s=!0,t.dead=!0;break}}for(let i=1;i<=Math.abs(o.movement[1]);i++){let a=o.movement[1]>=0?-1:1;if(this.pushBlockCollision([t.tilePos[0],t.tilePos[1]+i*a])){t.updatePos(t.pos.plus(new e(0,-40*(i-1)))),s=!0,t.dead=!0;break}}s||t.updatePos(t.pos.plus(new e(-40*o.movement[0],-40*o.movement[1])))})),t||(t=!0),o.pos[0]-=o.movement[0],o.pos[1]-=o.movement[1]})):this.getShuttles().forEach((o=>{this.men.filter((t=>s(t.tilePos,o.pos))).forEach((t=>{let s=!1;for(let i=1;i<=Math.abs(o.movement[0]);i++){let a=o.movement[0]>=0?1:-1;if(this.pushBlockCollision([t.tilePos[0]+i*a,t.tilePos[1]])){t.updatePos(t.pos.plus(new e(40*(i-1),0))),s=!0,t.dead=!0;break}}for(let i=1;i<=Math.abs(o.movement[1]);i++){let a=o.movement[1]>=0?1:-1;if(this.pushBlockCollision([t.tilePos[0],t.tilePos[1]+i*a])){t.updatePos(t.pos.plus(new e(0,40*(i-1)))),s=!0,t.dead=!0;break}}s||t.updatePos(t.pos.plus(new e(40*o.movement[0],40*o.movement[1])))})),t||(t=!0),o.pos[0]+=o.movement[0],o.pos[1]+=o.movement[1]})),this.shuttlesMoved=!this.shuttlesMoved}}l.ENGAGE=1,l.DISENGAGE=-1;const n=l;class h{constructor(t,e){this.ctx=t,this.board=e,this.origMap=JSON.parse(JSON.stringify(this.board.map)),this.deathSquareImg=new Image,this.deathSquareImg.src="./death-square.svg",this.loop=this.loop.bind(this)}async renderMapStartScreen(){this.drawGameArea(),this.ctx.globalAlpha=.15,this.renderMap(!1),this.ctx.globalAlpha=1,fontsLoaded||await new Promise((t=>setTimeout(t,250))),this.ctx.font="700 48px Roboto",this.ctx.textAlign="center",this.ctx.textBaseline="alphabetic",this.ctx.fillStyle="black",this.ctx.fillText(this.board.map.title,500,300),this.ctx.beginPath(),this.ctx.moveTo(275,320),this.ctx.lineTo(725,320),this.ctx.lineWidth=2,this.ctx.strokeStyle="black",this.ctx.stroke(),this.ctx.font="400 26px Roboto",this.ctx.fillText(this.board.map.subtitle,500,355),this.ctx.font="700 30px Roboto",this.ctx.fillStyle="crimson",this.ctx.fillText("Touch or Hit Enter",500,665)}renderNextState(){this.renderMap(!0),this.board.men.forEach((t=>this.drawBall(t.pos,t.color)))}drawBall(t,e,s){this.ctx.beginPath(),this.ctx.arc(t.i,t.j,s||h.MAN_RADIUS,0,2*Math.PI),this.ctx.fillStyle=e,this.ctx.fill(),this.ctx.closePath()}renderMap(t){t&&this.drawGameArea(),this.drawTile(this.board.map.start,"gainsboro"),this.drawTile(this.board.map.end,"lime"),this.board.map.floor.forEach((t=>this.drawTile(t,"#787878"))),this.drawShuttleLines(),this.drawBlockSlots(),this.board.getDeathSquares().forEach((t=>this.drawDeathSquare(t,"black"))),this.board.getABlocks().forEach((t=>this.drawTile(t.pos,"crimson","A"))),this.board.getShuttles().forEach((t=>this.drawTile(t.pos,"dodgerblue","S"))),this.board.getDBlocks().forEach((t=>this.drawTile(t.pos,"#FFAF00","D")))}drawGameArea(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,1e3,800)}printTime(t){const{timerPos:e}=this.origMap;this.ctx.font="700 26px Roboto",this.ctx.fillStyle="red",this.ctx.fillText("Timer: "+Math.floor(t/1e3),e[0],e[1])}drawTile(t,e,s){this.ctx.fillStyle=e,this.ctx.fillRect(40*t[0],40*t[1],40,40),s&&(this.ctx.fillStyle="white",this.ctx.font="bold 26px Roboto",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(s,40*t[0]+20,40*t[1]+22))}drawBlockSlots(){Object.values(this.origMap.aBlocks).forEach((t=>{this.ctx.fillStyle="crimson",this.ctx.fillRect(40*t.pos[0]+17,40*t.pos[1]+17,6,6),this.ctx.fillRect(40*(t.pos[0]+t.movement[0])+17,40*(t.pos[1]+t.movement[1])+17,6,6)})),Object.values(this.origMap.dBlocks).forEach((t=>{this.ctx.fillStyle="#FFAF00",this.ctx.fillRect(40*t.pos[0]+17,40*t.pos[1]+17,6,6),this.ctx.fillRect(40*(t.pos[0]+t.movement[0])+17,40*(t.pos[1]+t.movement[1])+17,6,6)}))}drawShuttleLines(){const t=this.ctx.globalAlpha;Object.values(this.origMap.shuttles).forEach((t=>{if(this.ctx.globalAlpha=.2,0!==t.movement[0]){const e=t.movement[0]>0?1:-1;for(let s=0;s<=Math.abs(t.movement[0]);s++)this.drawTile([t.pos[0]+s*e,t.pos[1]],"dodgerblue")}else{const e=t.movement[1]>0?1:-1;for(let s=0;s<=Math.abs(t.movement[1]);s++)this.drawTile([t.pos[0],t.pos[1]+s*e],"dodgerblue")}})),this.ctx.globalAlpha=t}drawDeathSquare(t){this.ctx.drawImage(this.deathSquareImg,40*t[0],40*t[1],40,40)}async renderGoalFlash(){for(let t=0;t<3;t++)this.drawTile(this.board.map.end,"magenta"),await new Promise((t=>setTimeout(t,48))),this.drawTile(this.board.map.end,"black"),await new Promise((t=>setTimeout(t,48)))}async printWinScreen(t){await new Promise((t=>setTimeout(t,100)));for(let e=0;e<3;e++){t.cloneNode().play();for(let t=0;t<3;t++)this.ctx.fillStyle="magenta",this.ctx.fillRect(0,0,1e3,800),await new Promise((t=>setTimeout(t,48))),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,1e3,800),await new Promise((t=>setTimeout(t,48)));e<2&&await new Promise((t=>setTimeout(t,200)))}this.loop()}printText(t,e,s,o){this.ctx.font=`700 ${t}px Roboto`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle=e,this.ctx.fillText("You Win!!",s,o)}drawWinText(){this.printText(50,"magenta",500,265),this.printText(50,"magenta",685,160),this.printText(50,"magenta",870,55),this.printText(50,"magenta",315,160),this.printText(50,"magenta",130,55),this.printText(50,"magenta",870,265),this.printText(50,"magenta",130,265),this.printText(50,"magenta",500,55),this.printText(50,"magenta",500,530),this.printText(50,"magenta",685,635),this.printText(50,"magenta",870,740),this.printText(50,"magenta",315,635),this.printText(50,"magenta",130,740),this.printText(50,"magenta",130,530),this.printText(50,"magenta",870,530),this.printText(50,"magenta",500,740),this.ctx.globalAlpha=1-this.ctx.globalAlpha,this.drawBall({i:685,j:260},"lime",8),this.drawBall({i:315,j:260},"lime",8),this.drawBall({i:870,j:155},"lime",8),this.drawBall({i:500,j:155},"lime",8),this.drawBall({i:135,j:155},"lime",8),this.drawBall({i:315,j:50},"lime",8),this.drawBall({i:685,j:50},"lime",8),this.drawBall({i:685,j:525},"lime",8),this.drawBall({i:315,j:525},"lime",8),this.drawBall({i:870,j:630},"lime",8),this.drawBall({i:500,j:630},"lime",8),this.drawBall({i:135,j:630},"lime",8),this.drawBall({i:315,j:735},"lime",8),this.drawBall({i:685,j:735},"lime",8)}loop(){let t=0,e=.05;setInterval((()=>{t+=e,(t<=0||t>=1)&&(e=-e),t<0&&(t=0),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,1e3,800),this.printText(150,"white",500,400),this.ctx.globalAlpha=t,this.drawWinText(),this.ctx.globalAlpha=1}),90)}}h.MAN_RADIUS=5;const m=h,r={0:{title:"Stage 1",subtitle:"Gettin' Yer Squares Wet",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[0,10],floor:[[1,10],[2,10],[3,10],[4,10],[5,10]],end:[6,10],aBlocks:{0:{pos:[4,10],movement:[0,1]}},dBlocks:{},shuttles:{},deathSquares:{}},1:{title:"Stage 2",subtitle:"Up to the Belly Button",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[0,10],floor:[[1,10],[2,10],[3,10],[4,10],[4,12],[4,13]],end:[4,14],aBlocks:{},dBlocks:{0:{pos:[4,9],movement:[0,1]}},shuttles:{},deathSquares:{}},2:{title:"Stage 3",subtitle:"Into the Deep End",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[0,10],floor:[[1,10],[2,10],[3,10],[4,10]],end:[10,10],aBlocks:{},dBlocks:{},shuttles:{0:{pos:[5,10],movement:[4,0]}},deathSquares:{}},3:{title:"Stage 4",subtitle:"Putting It All Together",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[0,10],floor:[[1,10],[2,10],[3,10],[4,10],[4,12],[4,13],[9,14],[10,14],[11,14],[12,14]],end:[13,14],aBlocks:{0:{pos:[11,14],movement:[0,1]}},dBlocks:{0:{pos:[4,9],movement:[0,1]}},shuttles:{0:{pos:[4,14],movement:[4,0]}},deathSquares:{}},4:{title:"Stage 5",subtitle:"Getting Serious Now",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[1,9],floor:[[2,9],[3,9],[4,9],[5,9],[6,9],[6,8],[6,7],[9,2],[10,2],[11,2],[12,2],[17,2],[18,2],[19,2],[20,2],[21,2],[20,3],[20,4],[20,5],[17,8],[17,9],[17,10],[17,11],[18,11],[19,11],[20,11],[21,11]],end:[22,11],aBlocks:{0:{pos:[21,1],movement:[0,1]}},dBlocks:{0:{pos:[6,10],movement:[0,-1]},1:{pos:[17,5],movement:[0,1]},2:{pos:[16,11],movement:[1,0]}},shuttles:{0:{pos:[6,6],movement:[0,-3]},1:{pos:[7,6],movement:[0,-3]},2:{pos:[8,6],movement:[0,-3]},3:{pos:[9,6],movement:[0,-3]},4:{pos:[13,2],movement:[3,0]},5:{pos:[20,6],movement:[-3,0]}},deathSquares:{0:[7,9],1:[22,2],2:[17,12],3:[6,6],4:[13,2],5:[20,6]}},5:{title:"Stage 6",subtitle:"Peek-a-Block",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[4,15],floor:[[4,14],[4,13],[6,13],[11,8],[11,6],[11,5],[11,4]],end:[20,4],aBlocks:{0:{pos:[4,13],movement:[-1,0]},1:{pos:[11,8],movement:[1,0]},2:{pos:[20,4],movement:[1,0]}},dBlocks:{0:{pos:[6,14],movement:[0,-1]},1:{pos:[11,9],movement:[0,-1]},2:{pos:[12,4],movement:[0,-1]},3:{pos:[13,4],movement:[0,1]},4:{pos:[14,4],movement:[0,-1]}},shuttles:{0:{pos:[6,8],movement:[0,3]},1:{pos:[7,8],movement:[3,0]},2:{pos:[15,4],movement:[-3,0]},3:{pos:[16,4],movement:[3,0]}},deathSquares:{}},6:{title:"Stage 7",subtitle:"Key Sequences",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[2,9],floor:[[3,9]],end:[22,9],aBlocks:{0:{pos:[5,9],movement:[0,-1]},1:{pos:[11,9],movement:[0,-1]},2:{pos:[17,9],movement:[0,-1]}},dBlocks:{0:{pos:[8,9],movement:[0,1]},1:{pos:[14,9],movement:[0,1]},2:{pos:[20,9],movement:[0,1]}},shuttles:{0:{pos:[4,9],movement:[2,0]},1:{pos:[9,9],movement:[-2,0]},2:{pos:[10,9],movement:[2,0]},3:{pos:[15,9],movement:[-2,0]},4:{pos:[16,9],movement:[2,0]},5:{pos:[21,9],movement:[-2,0]}},deathSquares:{}},7:{title:"Stage 8",subtitle:"Mirror Blox",menQuota:1,timeLimit:8e3,timerPos:[500,275],tickRate:4,start:[11,9],floor:[[6,9],[5,9],[4,9],[3,9],[3,7],[3,6],[4,6],[5,6],[5,4],[5,3],[6,3],[7,3],[9,3],[10,3],[11,3],[13,3],[14,3],[15,3],[17,3],[18,3],[19,3],[19,4],[19,6],[20,6],[21,6],[21,7],[21,9],[20,9],[19,9],[18,9]],end:[13,9],aBlocks:{},dBlocks:{},shuttles:{0:{pos:[10,9],movement:[-3,0]},1:{pos:[3,8],movement:[-1,0]},2:{pos:[6,5],movement:[-1,0]},3:{pos:[8,3],movement:[0,-1]},4:{pos:[12,2],movement:[0,1]},5:{pos:[16,3],movement:[0,-1]},6:{pos:[18,5],movement:[1,0]},7:{pos:[21,8],movement:[1,0]},8:{pos:[14,9],movement:[3,0]}},deathSquares:{}},8:{title:"Stage 9",subtitle:"Key Jumble",menQuota:1,timeLimit:0,timerPos:[0,0],tickRate:8,start:[3,9],floor:[[4,9],[5,9],[6,9],[8,12],[9,12],[10,12],[11,6],[10,6],[9,6],[9,5],[9,4],[9,3],[21,3]],end:[21,8],aBlocks:{0:{pos:[7,12],movement:[0,1]},1:{pos:[11,10],movement:[-1,0]},2:{pos:[13,7],movement:[1,0]},3:{pos:[13,3],movement:[0,-1]},4:{pos:[15,3],movement:[0,1]},5:{pos:[17,3],movement:[0,-1]}},dBlocks:{0:{pos:[5,12],movement:[1,0]},1:{pos:[10,9],movement:[1,0]},2:{pos:[14,6],movement:[-1,0]},3:{pos:[8,3],movement:[1,0]},4:{pos:[22,3],movement:[-1,0]},5:{pos:[18,8],movement:[1,0]}},shuttles:{0:{pos:[6,12],movement:[0,-2]},1:{pos:[11,9],movement:[0,3]},2:{pos:[13,9],movement:[0,-3]},3:{pos:[11,3],movement:[9,0]},4:{pos:[19,3],movement:[0,5]}},deathSquares:{}},9:{title:"Stage 10",subtitle:"Death Spiral",menQuota:1,timeLimit:16e3,timerPos:[500,525],tickRate:4,start:[21,18],floor:[[1,17],[1,16],[1,15],[1,14],[1,9],[1,8],[1,7],[1,6],[2,2],[3,2],[4,2],[5,2],[10,2],[11,2],[12,2],[13,2],[18,2],[19,2],[20,2],[21,2],[21,7],[21,8],[21,9],[21,10],[21,15],[20,15],[19,15],[18,15],[13,15],[12,15],[11,15],[10,15],[5,15],[5,14],[5,13],[5,12],[5,7],[5,6],[6,6],[7,6],[12,6],[13,6],[14,6],[17,7],[17,8],[17,9],[14,10],[13,10],[11,18],[10,18],[9,18],[8,18],[7,18],[6,18],[5,18],[4,18],[3,18],[2,18],[1,18],[16,18],[15,18],[14,18],[13,18],[12,18],[17,18],[18,18],[19,18],[20,18]],end:[12,10],aBlocks:{},dBlocks:{},shuttles:{0:{pos:[1,10],movement:[0,3]},1:{pos:[1,2],movement:[0,3]},2:{pos:[9,2],movement:[-3,0]},3:{pos:[17,2],movement:[-3,0]},4:{pos:[21,6],movement:[0,-3]},5:{pos:[21,14],movement:[0,-3]},6:{pos:[14,15],movement:[3,0]},7:{pos:[6,15],movement:[3,0]},8:{pos:[5,8],movement:[0,3]},9:{pos:[11,6],movement:[-3,0]},10:{pos:[17,6],movement:[-2,0]},11:{pos:[15,10],movement:[2,0]}},deathSquares:{}},10:{title:"Stage 11",subtitle:"Bump Fest",menQuota:1,timeLimit:7e3,timerPos:[385,325],tickRate:4,start:[12,1],floor:[[12,3],[12,4],[12,5],[14,5],[14,6],[16,6],[16,7],[16,8],[14,8],[14,9],[12,9],[12,10],[12,11],[10,11],[10,12],[8,12],[8,13],[8,14],[10,14],[10,15],[12,15],[12,16],[12,17]],end:[12,18],aBlocks:{},dBlocks:{0:{pos:[12,0],movement:[0,1]},1:{pos:[11,5],movement:[1,0]},2:{pos:[13,6],movement:[1,0]},3:{pos:[17,8],movement:[-1,0]},4:{pos:[15,9],movement:[-1,0]},5:{pos:[13,11],movement:[-1,0]},6:{pos:[11,12],movement:[-1,0]},7:{pos:[7,14],movement:[1,0]},8:{pos:[9,15],movement:[1,0]}},shuttles:{},deathSquares:{}}};function d(t){t.preventDefault();const e=new KeyboardEvent("keydown",{code:"KeyA"});window.dispatchEvent(e)}function c(){const t=new KeyboardEvent("keyup",{code:"KeyA"});window.dispatchEvent(t)}function p(t){t.preventDefault();const e=new KeyboardEvent("keydown",{code:"KeyS"});window.dispatchEvent(e)}function v(){const t=new KeyboardEvent("keyup",{code:"KeyS"});window.dispatchEvent(t)}function u(t){t.preventDefault();const e=new KeyboardEvent("keydown",{code:"KeyD"});window.dispatchEvent(e)}function w(){const t=new KeyboardEvent("keyup",{code:"KeyD"});window.dispatchEvent(t)}$((async function(){const t=document.getElementById("myCanvas").getContext("2d");await new Promise((t=>setTimeout(t,500)));let e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),window.onorientationchange=function(){switch(window.orientation){case 0:case 90:case-90:window.location.reload()}},[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some((t=>navigator.userAgent.match(t)))&&($(".softkey-container-1").css("display","flex"),$(".softkey-container-2").css("display","flex"));const s=navigator.userAgent.toLowerCase();/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(s)&&screen.orientation.lock("portrait-primary"),$(".softkey-a").on("touchstart",d),$(".softkey-a").on("touchend",c),$(".softkey-s").on("touchstart",p),$(".softkey-s").on("touchend",v),$(".softkey-d").on("touchstart",u),$(".softkey-d").on("touchend",w),new class{constructor(t){this.ctx=t,this.board=new n(r[0]),this.view=new m(t,this.board),this.deadMen=[],this.stageIntervalId=null,this.playerIntervalId=null,this.mapIndex=0,$(window).on("keydown",this.handleKeyDownEvent.bind(this)),$(window).on("keyup",this.handleKeyUpEvent.bind(this)),$("body").on("touchstart",this.startLevel.bind(this)),this.aBlocksMoved=!1,this.dBlocksMoved=!1,this.shuttlesMoved=!1,this.levelStarted=!1,this.goalSound=new Audio("./audio/goal.wav"),this.goalSound.volume=.5,this.timeRemaining=r[0].timeLimit,this.tickRate=r[0].tickRate,this.view.renderMapStartScreen()}loadNextMap(){Object.values(r).length>this.mapIndex+1?(this.aBlocksMoved=!1,this.dBlocksMoved=!1,this.shuttlesMoved=!1,this.levelStarted=!1,this.board=new n(r[++this.mapIndex]),this.view=new m(this.ctx,this.board),this.timeRemaining=r[this.mapIndex].timeLimit,this.tickRate=r[this.mapIndex].tickRate,this.view.renderMapStartScreen()):this.view.printWinScreen(this.goalSound)}handleKeyDownEvent(t){switch(t.code){case"Enter":this.startLevel();break;case"KeyA":this.aBlocksMoved||(this.aBlocksMoved=!0,this.board.moveABlocks());break;case"KeyS":this.shuttlesMoved||(this.shuttlesMoved=!0,this.board.moveShuttles());break;case"KeyD":this.dBlocksMoved||(this.dBlocksMoved=!0,this.board.moveDBlocks())}}handleKeyUpEvent(t){switch(t.code){case"KeyA":this.aBlocksMoved&&(this.board.moveABlocks(),this.aBlocksMoved=!1);break;case"KeyS":this.shuttlesMoved&&(this.board.moveShuttles(),this.shuttlesMoved=!1);break;case"KeyD":this.dBlocksMoved&&(this.board.moveDBlocks(),this.dBlocksMoved=!1)}}startLevel(){this.levelStarted||(this.levelStarted=!0,this.stageIntervalId=window.setInterval(this.step.bind(this),this.tickRate),this.playerIntervalId=window.setInterval(this.board.loadPlayer.bind(this.board),5e3))}async step(){this.board.men.forEach(((t,e)=>{t.move(),t.reachedFinish?(this.board.removeMan(e),this.board.addGoal(),this.goalSound.play(),this.view.renderGoalFlash()):t.dead&&(window.clearInterval(this.playerIntervalId),this.deadMen.push(t),setTimeout((()=>{this.deadMen.pop(),this.playerIntervalId=window.setInterval(this.board.loadPlayer.bind(this.board),5e3)}),1e3),this.board.removeMan(e))})),(0===this.board.men.length||0===this.timeRemaining&&r[this.mapIndex].timeLimit>0)&&0===this.deadMen.length?(window.clearInterval(this.playerIntervalId),window.clearInterval(this.stageIntervalId),this.board.goalCount===this.board.menQuota?await new Promise((t=>setTimeout(t,450))):this.mapIndex-=1,this.loadNextMap()):(this.view.renderNextState(),this.deadMen.forEach((t=>this.view.drawBall(t.pos,"red"))),r[this.mapIndex].timeLimit>0&&(this.timeRemaining-=this.tickRate,this.view.printTime(this.timeRemaining)))}}(t)}))})();